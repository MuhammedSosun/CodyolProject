  generator client {
    provider = "prisma-client-js"
  }

  datasource db {
    provider = "postgresql" // mysql / sqlite ise değiştir
    url      = env("DATABASE_URL")
  }

  enum Role {
    USER
    ADMIN
    SUPER_ADMIN
  }

  model User {
  id       String @id @default(uuid())
  username String @unique
  email    String @unique
  password String
  role     Role   @default(USER)

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  ownedCustomers   Customer[] @relation("CustomerOwner")
  assignedTasks    Task[]
  createdActivities Activity[]

  refreshTokens RefreshToken[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([organizationId])
}


  model RefreshToken {
    id           String   @id @default(uuid())
    refreshToken String   @unique
    expiredAt    DateTime

    userId String
    user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  }


  model Organization {
    id String @id @default(uuid())

    // Identity
    name             String
    slug             String           @unique
    organizationType OrganizationType

    // Business info
    legalName String?
    industry  String?
    website   String?
    email     String?
    phone     String?

    // Subscription
    planType PlanType @default(FREE)
    isActive Boolean  @default(true)

    // Ownership (Auth / Super Admin)
    ownerUserId String

    proposals Proposal[]

    // Relations
    users      User[]
    customers  Customer[]
    activities Activity[]
    tasks      Task[]

    // Audit
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    @@index([ownerUserId])
    @@index([isActive])
    @@index([deletedAt])
  }


  enum OrganizationType {
    COMPANY
    CLUB
    NGO
  }

  enum PlanType {
    FREE
    PRO
    ENTERPRISE
  }

  model Customer {
    id String @id @default(uuid())

    // Multi-tenant
    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    // Ownership (CRM içi sorumlu)
    ownerUserId String
    owner       User @relation("CustomerOwner", fields: [ownerUserId], references: [id])

    // Personal / Company Info
    fullName   String
    email       String?
    phone       String?
    companyName String?
    vatNumber   String?
    website     String?
    address     String?
    description String?
    designation String?

    // CRM lifecycle
    status CustomerStatus @default(NEW)

    proposals Proposal[]

    // Relations
    activities Activity[]
    tasks      Task[]

    // Audit
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    @@index([organizationId])
    @@index([ownerUserId])
    @@index([status])
    @@index([deletedAt])
  }



 enum CustomerStatus {
  NEW                 // Yeni
  CONTACTED           // İletişim Kuruldu
  OFFER_SENT          // Teklif Gönderildi
  WAITING_APPROVAL    // Onay Bekliyor
  APPROVED            // Onaylandı
  WON                 // Kazanıldı
  LOST                // Kaybedildi
}


  model Task {
  id String @id @default(uuid())

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  assignedUserId String
  assignedUser   User @relation(fields: [assignedUserId], references: [id])

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  title       String
  description String?

  startDate DateTime?
  endDate   DateTime?

  status TaskStatus @default(NEW)

  activities Activity[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  @@index([organizationId])
  @@index([assignedUserId])
  @@index([customerId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@index([deletedAt])
}

 enum TaskStatus {
  NEW
  IN_PROGRESS
  ON_HOLD
  COMPLETED
}


  model Activity {
  id String @id @default(uuid())

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  createdByUserId String?
  createdByUser   User? @relation(fields: [createdByUserId], references: [id])

  taskId String?
  task   Task? @relation(fields: [taskId], references: [id])

  type        ActivityType
  title       String
  description String?

  createdAt DateTime @default(now())
  deletedAt DateTime?

  @@index([organizationId])
  @@index([customerId])
  @@index([createdByUserId])
  @@index([type])
  @@index([deletedAt])
  @@index([taskId])
}


  enum ActivityType {
  CALL
  EMAIL
  NOTE
  MEETING

  TASK_CREATED
  TASK_UPDATED
  TASK_STATUS_CHANGED
  TASK_COMPLETED

  CUSTOMER_CREATED
  CUSTOMER_UPDATED

  PROPOSAL_CREATED
  PROPOSAL_STATUS_CHANGED
}

  model Proposal{
    id String @id @default(uuid())

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    // Customer
    customerId String
    customer   Customer @relation(fields: [customerId], references: [id])

    title      String
    status     ProposalStatus @default(DRAFT)
    validUntil DateTime

    totalAmount Decimal? @db.Decimal(12, 2)
    currency    String   @default("TRY")

    createdByUserId String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    deletedAt DateTime?

    @@index([organizationId])
    @@index([customerId])

  }
  enum ProposalStatus {
  DRAFT        // Taslak
  SENT         // Gönderildi
  EXPIRED      // Süresi Doldu
  REJECTED     // Reddedildi
  APPROVED     // Kabul Edildi
}



